# Redis와 캐싱

## Redis란?

In-memory 기반의 "키-값" 구조 데이터 관리 시스템이다. 모든 데이터를 저장하고 조회하기 빠른 Read, Write 속도를 보장하는 **비관계형 데이터베이스**이다.
다양한 용도로 사용되지만 빠른 속도 때문에 `캐시의 용도`로 흔히 사용된다.

## Cache

그렇다면 캐시란 무엇일까?  
캐시란 **자주 사용하는 데이터나 값을 미리 복사해 놓는 임시장소**를 가리킨다.
잠시 컴퓨터구조 얘기를 해보자. 예를들어, 하드디스크(보조기억장치)에서 저장된 프로그램을 읽어온다고 할 때 CPU는 프로그램을 실행하기 위해 주기억장치에 저장된 프로그램 명령어와 데이터를 처리하고 그것을 다시 저장할 것이다. 이 과정에서 각 장치에 접근하는 시간은 보조기억장치 > 주기억장치 순으로 느리다. 만약 모든 작업들을 매번 이런 식으로 처리하게 되면 처리 속도는 현저히 느려질 것이다.
때문에 CPU 내부에 cache를 두어 자주 사용하는 데이터나 작업들을 멀리까지 가서 가져올 필요가 없도록 한다.
![image](https://user-images.githubusercontent.com/31172248/136685030-8ca13711-3591-4314-9b66-4be82ec89235.png)


## 캐시의 사용 전략

### Look-Aside caching

보통 모든 데이터를 캐시에 저장하는 것이 비효율적인 상황에 쓴다.

1. 가장 먼저 클라이언트가 데이터를 요청하면 캐시를 확인한다. -> 데이터가 없다?
2. 그렇다면 애플리케이션은 DB에서 데이터를 조회하고 사용자한테 제공한 뒤
3. 가져온 데이터를 캐시 저장소에 저장한다.

![image](https://user-images.githubusercontent.com/31172248/136685063-3aa30047-294a-4677-af2c-4afdc1400a7a.png)


### Write back

CPU 데이터를 사용할 때 데이터는 먼저 캐시로 기록되는데 캐시 내에 일시적으로 저장 후 블록에서 캐시가 해제될 때만 DB에 기록하는 방식이다. 즉, 데이터를 쓸 때 메모리에는 쓰지 않고 캐시에만 업데이트하다가 한꺼번에 보조기억장치/주기억장치로 기록하는 방식이다. 하지만, 이 경우 DB에 쓰기 전 캐시 서버에 장애가 발생해 서버가 죽어버린다면 값의 차이가 발생할 수도 있다.

[그 외의 방법들]
https://wnsgml972.github.io/database/2020/12/13/Caching/

## Redis 특징

1. 서버의 분산처리를 통해 읽기 성능을 증대 시킬 수 있다. (갱신용 master 1대, 복제된 읽기 전용 서버 n대)
   ![image](https://user-images.githubusercontent.com/31172248/136685116-7fdbf29f-c578-4007-9a4a-6e660ae40a5b.png)

2. 문자열, 리스트, 해시, 셋, sorted set과 같은 다양한 데이터형을 지원한다.

## 사용 사례

1. 인증 토큰 저장소  
   -> JWT 토큰을 예로 들어, 사용자가 로그인 시 JWT 토큰을 발급 받게되면 JWT 토큰은 사용자에게 쿠키형태로 저장되고 Redis Server에 그 정보를 남긴다. 그 후, JWT 토큰을 포함한 요청 요구 시 유저의 브라우저에 저장되어있는 JWT 토큰값이 Redis Server에 남아있고, 그 토큰이 유효하다면 응답한다.
2. 랭킹 보드  
   -> 게임에서 자주 써야하는 랭킹 top n 등을 사용할 때 redis를 이용한다.
3. 유저 API 리밋  
   -> 만약 User의 정보를 제공하는 API를 요청할 때, 이 API가 1초에 20개의 요청으로 제한되어있다고 가정하면 수많은 API 요청이 들어왔을 때 Limit이 초과하게된다. 이를 방지하기 위해 동시에 접속하는 모든 유저의 Request를 Redis로 구현한 메세지큐에 적재하고 rate limit을 넘지 않는 속도로 처리하면 된다. (흥미로운 내용이라 참고 주소 : https://team-platform.tistory.com/54)
4. Job Queue  
   https://mohewedy.medium.com/implement-job-queue-in-redis-9f0f8d394561
5. 여러 서버의 데이터를 공유하고 싶을 때

## 다양한 데이터 형식

Redis가 Collection을 사용하는 이유는 높은 생산성 때문이다. 덕분에 데이터를 다양한 방식으로 활용할 수 있다.  
ex) List형 데이터 입력과 삭제가 MySQL보다 10배 빠르다.

https://velog.io/@devsh/Redis-1-Redis란. 
https://ozofweird.tistory.com/entry/Redis-Redis-구조-실제-활용-사례. 
https://jyejye9201.medium.com/레디스-redis-란-무엇인가-2b7af75fa818. 
