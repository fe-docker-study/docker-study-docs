# 배포 간편화 도구

- 애플리케이션을 배포하기 위한 환경을 구성하는 것은 매우 복잡하고, 고정된 값이 아니라 구성된 환경에 따라 많은 부분을 동적으로 변경해야함
- 동적 변경 사항을 빠르게 적용할 수 있도록 도와주는 도구 → 커스터마이즈(kustomize), 헬름(Helm)
- kubectl은 바이너리 실행 파일로 짜인 배포도구, 커스터마이즈와 헬름은 kubectl을 좀 더 확장해 복잡한 오브젝트와 구성환경을 자동으로 맞춰주는 도구
- kubectl은 고정적인 값으로 설정된 매니페스트를 그대로 사용, 커스터마이즈는 일부 내용을 가변적으로 변경해 사용, 헬름은 모든 내용을 설정할 수 있는 값을 제공해 필요에 따라 사용자 환경에 맞는 설정갑승로 변경

### kubectl

- 쿠버네티스에 기본으로 포함된 커맨드라인 도구로 추가설치 없이 바로 사용 가능
- 오브젝트 생성과 클러스터에 존재하는 오브젝트, 이벤트 등의 정보를 확인하는 데 활용도 높은 도구
- 오브젝트의 명세가 정의된 yaml 파일을 인자로 입력받아 파일 내용에 따라 오브젝트를 배포할 수도 있음

### 커스터마이즈

- 오브젝트를 사용자의 의도에 따라 유동적으로 배포할 수 있음
- 별도의 커스터마이즈 실행 파일을 활용해 커스터마이즈 명세를 따르는 yaml파일을 생성할 수 있음
- 명령어로 배포 대상 오브젝트의 이미지 태그와 레이블 같은 명세를 변경하거나 일반 파일을 이용해 컨피그맵과 시크릿을 생성하는 기능을 지원. 운영 중인 환경에서 배포 시 가변적인 요소를 적용하는 데 적합
- kustomize 명령어를 제공, kustomization.yaml이라는 기본 매니페스트를 만들고 이 파일에 변경해야하는 값들을 적용.

### 헬름

- 쿠버네티스 사용자의 70%이상이 사용

- 오브젝트 베포에 필요한 사양이 이미 정의된 차트라는 패키지를 활용

- 헬름 차트 저장소가 온라인에 있기 때문에 패키지를 검색하고 내려받아 사용하기가 매우 간편

- 헬름 차트는 자체적인 템플릿 문법을 사용하므로 가변적인 인자를 배포할 떄 적용해 다양한 배포 환경에 맞추거나 우너하는 조건을 적용할 수 있음

- 헬름은 오브젝트를 묶어 패키지 단위로 관리함으로 단순한 1개의 명령어로 애플리케이션에 필요한 오브젝트들을 구성할 수 있음

  

## 헬름

### 헬름 개요

- 쿠버네티스에 패키지를 손쉽게 배포할 수 있도록 패키지를 관리하는 쿠버네티스 전용 패키지 매니저
- 패키지는 실행 파일뿐만 아니라 실행 환경에 필요한 의존성 파일과 환경 정보들의 묶음
- 패키지 매니저는 외부에 있는 저장소에서 패키지 정보를 받아와 패키지를 안정적으로 관리하는 도구
- 패키지 매니저는 설치에 필요한 의존성 파일들을 관리하고 간편하게 설치할 수 있도록 도와줌
- 헬름 기본 저장소는 이티팩트허브([artifacthub.io](http://artifacthub.io))로, 다른 패키지 매니저처럼 외부에 있음. 다른 저장소와는 달리 아티팩트허브에서는 설치할 패키지에 대한 경로만을 제공

### 헬름 장점

- 컨테이너 인프라 환경에서 애플리케이션을 배포하려면 ConfigMap, ServiceAccount, PV, PVC, Secret 등 애플리케이션 배포 구성에 필요한 모든 쿠버네티스 오브젝트를 작성하고, kubectl 명령을 실행해서 쿠버네티스 클러스터에 설치해야함. 헬름의 경우 환경에 맞춰 변경할 수 있고 주소할당영역도 변경 가능.
- 다수의 오브젝트 배포 yaml은 파일 구분자인 ‘---’로 묶어 단일 야믈로 작성해 배포가 가능한데 여러사람이 동시에 작업하면 충돌이 발생할 수 있음. 헬름을 사용하면 요구 조건별로 리소스를 편집하거나 변수를 넘겨서 처리하는 패키지를 만들 수 있음. 이렇게 다양한 요구조건을 처리할 수 있는 패키지를 차트(chart)라고 하고, 헬름 저장소에 공개해 여러 사용자와 공유. 각 사용자는 공개된 저장소에 등록된 차트를 이용해 애플리케이션을 원하는 형태로 쿠버네티스에 배포할 수 있음
- 배포한 애플리케이션을 업그레이드하거나 되돌릴 수 있는 기능과 삭제할 수 있는 기능을 제공

### 헬름의 전반적인 흐름

![Untitled](https://user-images.githubusercontent.com/90545926/158062388-bd6e622e-1d71-4b84-b0c9-68b85b25d4d5.png)

#### 생산자 영역

- 생산자가 헬름 명령으로 작업 공간을 생성하면 templates 디렉터리로 애플리케이션 배포에 필요한 여러 yaml 파일과 구성파일을 작성할 수 있음
- templates 디렉터리에서 조건별 분기, 값 전달 등을 처리할 수 있도록 value.yaml에 설정된 키를 사용
- 필요한 패키지의 여러분기 처리나 배포에 대한 구성이 완료되면 생산자는 차트의 이름, 목적, 배포되는 애플리케이션 버전과 같은 패키지 정보를 Chart.yaml에 채워넣음
- 앞의 과정을 거쳐 차트 구성이 완료되면 생산자가 생산자 저장소에 업로드하고, 업로드한 생산자 저장소를 아티팩트허브에 등록하면 사용자는 아티팩트허브에서 생산자가 만든 저장소를 찾을 수 있음

#### 아티팩트허브 영역

- 아티팩트 허브 검색을 통해 사용자가 찾고자 하는 애플리케이션 패키지를 검색하면 해당 패키지가 저장된 주소를 확인. 이렇게 확인한 주소는 각 애플리케이션을 개발하는 주체가 관리

#### 사용자 영역

- 사용자는 설치하려는 애플리케이션의 차트 저장소 주소를 아티팩트허브에서 얻으면 헬름을 통해서 주소를 등록. 그리고 이를 최신으로 업데이트한 후 차트를 내려받고 설치.
- 헬름을 통해 쿠버네티스에 설치된 애플리케이션 패키지를 릴리스라고 함
- 헬름을 통해 배포된 릴리스를 다시 차트를 사용해 업그레이드할 수 있고, 원래대로 되돌릴 수 있음